# Yukari Data Manager

**Yukari Data Manager** は、**Apple Numbers** で作成されたスプレッドシートであり、Yukari Preference Questionnaire（Yukari選好アンケート）のデータを整理し、Yukari Code チーム最適化プログラム用にデータを作成し、最適化されたチーム編成を確認するためのツールです。

1. **最適化プログラム用のデータ整理**
   必要なデータファイルを整理し、最適化計算を実行できるように準備します。
2. **最適化されたチーム編成の確認**
   最適化プロセスが完了した後、スプレッドシートを使用して結果を確認し、必要に応じて調整を行います。

## Excel 版 Yukari Data Manager

オリジナルの **Yukari Data Manager** は Apple Numbers で作成されましたが、xlsx 形式にエクスポートされています。 ただし、エクスポート時に一部の数式が正しく変換されなかったため、手動で修正を加えました。 現在、Excel 版はベータテスト版として提供されています。

## Yukari Data Manager を開く

- **macOS**: Apple Numbers アプリケーションで直接開く。
- **Windows および macOS（Web 経由）**: Apple iCloud Numbers を使用して [iCloud.com](https://www.icloud.com/) で開く。
- **Windows および macOS**: ベータテスト版の Excel 版を使用する。

## 設定

1. **生徒リストの作成**
   生徒の識別番号（シリアルナンバー）は 0 から始まります（1 ではなく）。 プライバシー保護のため、識別番号をランダム化することも可能です。
2. **相性マトリックスの定義**
   1〜10 の数値で相性を定義します（数値が大きいほど相性が良い）。

### 注意点

- チーム編成には以下のテーブルを使用します：
  - **Student List（生徒リスト）**
  - **Matching Matrices（相性マトリックス）**
  - **Questionnaire Data（アンケートデータ）**
  - **Restrictions（制約）**
  - **Compatibility Code（相性コード）**
  - **Team Assignment（チーム編成）**
- 内部計算に使用されるテーブル：
  - **Compatibility（相性）**
  - **Preference Matching（選好マッチング）**
  - **Commitment Matching（関係マッチング）**
  - **Preferences（選好）**
  - **Commitment（関係）**

### 生徒数が表の制限を超える場合

Yukari Data Manager は最大 160 人のクラスサイズをサポートするように設計されています。 クラスサイズがこの制限を超える場合は、以下の方法で調整してください：

1. すべてのテーブル（内部計算に使用されるものを含む）の行と列を拡張し、生徒数の増加に対応する。
2. 追加したセルに対して、すべての数式が正しく適用されることを確認する。

### 注意点

Yukari Codeの初期設定では、最大で150人の学生に対応しています。これを超える人数に対応させたい場合は、ソースコードに記載されている定数を変更し、再コンパイルする必要があります。

## アンケートデータの準備

1. Google Forms からアンケートデータを Excel 形式で取得する。
2. データを整理する。
3. 整理したデータを **Questionnaire Data** タブにコピー＆ペーストする。
4. 欠損データは空白のままにする（プレースホルダーは使用しない）。

## 制約の設定

相性の調整は、該当するセルに -10 から +10 の数値を入力することで可能です。 以下の例を参考にしてください。

### 同じチームに複数の転校生を配置しないようにする

- 各転校生の対応するセルに `-4` 以下の値を入力する。

### 成績上位者を均等に配置する

1. チーム数（N）を決定する。
2. 成績上位N名を特定する。
3. これらの成績上位者同士が同じチームにならないように `-4` 以下の値を入力する。

## 最適化プログラム用データの作成

テキストエディタを使用して、最適化プログラムに必要なデータを作成します。

### ヘッダーデータの作成

1. **"header.txt"** という名前のプレーンテキストファイルを作成する。
2. 1行目に生徒の総数を入力する。
3. スプレッドシートの **Property Code** 列（ヘッダーを除く）をコピーする。
4. 2行目に貼り付ける。
5. ファイルを保存する。

### 相性データの作成

1. **"compatibility.txt"** という名前のプレーンテキストファイルを作成する。
2. スプレッドシートの **Compatibility Code** 列（ヘッダーを除く）をコピーし、ファイルに貼り付ける。
3. `grep` コマンドを使用して、不要なタブや空白行を削除する。
4. ファイルを保存する。

### 最適化プログラム用データのコンパイル

1. **"data.txt"** という名前のプレーンテキストファイルを作成する。
2. `header.txt` の内容を `data.txt` にコピーする。
3. `compatibility.txt` の内容を `data.txt` の最後に追加する。
4. `data.txt` の最終行に `0 0 0` を追加する。
5. ファイルを保存し、以下のコマンドで最適化プログラムを実行する。

```
% ./grouping_ils data.txt
```

## 最適化されたチーム編成の確認

1. **result.txt** から最適なチーム編成を選択する（下の例を参照）。
2. 選択したチーム編成をコピーし、**Team Assignment** タブの青いボックスに貼り付ける。

- Excel版の場合は2がうまくいきません。いったんresult.txt を **CSV** としてExcelで開き、結果の部分をYDMにコピー＆ペーストしてください。

### 出力例

```
0,4,1,44g,57,85g,8 9 8 9 10 10 ,54.0,54,2,2,0,
1,4,3g,20g,101g,118gH,7 10 10 7 7 8 ,49.0,49,4,0,1,
2,4,5g,59,67g,76,10 9 10 9 6 10 ,52.0,54,2,2,0,
3,4,14,23g,38g,94,7 7 6 7 6 6 ,33.0,39,2,2,0,
4,4,35g,68g,78g,113gH,10 6 7 10 10 10 ,51.0,53,4,0,1,
5,4,0,4g,53g,119H,6 6 9 7 7 8 ,39.0,43,2,2,1,
6,4,10g,52,120H,123gH,9 10 8 7 8 6 ,46.0,48,2,2,2,
7,4,16g,17g,33,55,10 10 10 10 10 10 ,60.0,60,2,2,0,
8,4,9g,40,49,90g,9 10 9 9 7 9 ,53.0,53,2,2,0,
9,4,83,88,95,97,9 9 10 10 9 10 ,57.0,57,0,4,0,
10,4,12,63,69g,99g,9 10 6 10 10 10 ,53.0,55,2,2,0,
11,4,27g,50,60g,82,9 6 6 10 10 6 ,41.0,47,2,2,0,
12,4,22,39,58,124H,7 10 8 6 6 8 ,41.0,45,0,4,1,
13,4,43g,66g,105,107,6 7 6 7 10 8 ,40.0,44,2,2,0,
14,4,46,86,110,122H,9 10 9 10 10 9 ,57.0,57,0,4,1,
15,4,25g,98g,103,109,7 10 10 6 6 7 ,42.0,46,2,2,0,
16,4,6,29g,36,51g,10 6 6 8 6 10 ,40.0,46,2,2,0,
17,4,65,87g,91g,114H,10 7 9 9 8 10 ,53.0,53,2,2,1,
18,4,48,56,112,116H,8 6 7 8 6 8 ,39.0,43,0,4,1,
19,4,21,45,72g,77g,6 7 6 7 6 6 ,30.0,38,2,2,0,
20,4,11,47g,61g,108,9 7 7 9 6 10 ,46.0,48,2,2,0,
21,4,31g,34g,100,126H,8 6 10 6 7 8 ,41.0,45,2,2,1,
22,4,7g,54,89g,102,7 7 8 10 8 8 ,48.0,48,2,2,0,
23,4,2,93,111g,115gH,7 6 6 9 6 6 ,32.0,40,2,2,1,
24,4,19,41g,73,121gH,6 6 7 10 9 7 ,41.0,45,2,2,1,
25,4,15g,18,30g,79,9 7 10 7 10 8 ,51.0,51,2,2,0,
26,4,24g,64,71g,80,7 6 10 7 7 7 ,42.0,44,2,2,0,
27,4,42,74,75g,127gH,6 7 7 10 6 7 ,39.0,43,2,2,1,
28,4,8,13g,28,37g,10 10 10 10 10 10 ,60.0,60,2,2,0,
29,4,70,81g,92,117gH,9 10 10 10 9 10 ,58.0,58,2,2,1,
30,4,26g,32,62g,96,9 10 10 10 10 10 ,59.0,59,2,2,0,
31,4,84g,104g,106g,125gH,9 8 7 9 9 8 ,50.0,50,4,0,1,
```

## 注意事項

このファイルのサンプルデータは、ランダム化または AI によって生成されたものであり、実在の個人情報は含まれていません。
